"use strict";(function(){var e=this;if("undefined"==typeof t){if("function"!=typeof require)throw new Error('Portals requires "Promise" support');var t=require("promise/lib/es6-extensions")}var o=function(e){e=e||{};for(var t=1;t<arguments.length;t++){var r=arguments[t];if(r)for(var n in r)r.hasOwnProperty(n)&&("object"==typeof r[n]?(e[n]=e[n]||{},o(e[n],r[n])):e[n]=r[n])}return e},r=function(e){if("string"!=typeof e.method)throw new Error("Invalid method provided");if("string"!=typeof e.url)throw new Error("Invalid url provided");return"object"!=typeof e.headers&&(e.headers={}),e},n=function(e){return e=o({},this.globals,e)},s=function(e){return 0!==e.url.indexOf("http")&&(e.url=(e.hostname||"")+e.url),e},i=function(e){const t=e.body||e.data;return"object"!=typeof t||e.dontEncodeJson||("application/json"===e.headers["Content-Type"],e.body=JSON.stringify(t)),e},p=function(e){return e.headers["Content-Type"]&&-1!==e.headers["Content-Type"].indexOf("json")&&(e.body=JSON.parse(e.body)),e},u=function(){this.globals={hostname:"",method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}},this._requestInterceptors=[r],this._responseInterceptors=[],this._catchInterceptors=[]};u.prototype.send=function(e){if("object"!=typeof e)throw new Error("Options must be an object!");for(var o=0;o<this._requestInterceptors.length;o++)if(e=this._requestInterceptors[o].call(this,e),"object"!=typeof e)throw new Error("Options object is no longer an object after interception!");var r=this,n=new XMLHttpRequest;"withCredentials"in n||"undefined"==typeof XDomainRequest||(n=new XDomainRequest),n.open(e.method.toUpperCase(),e.url,!0),n.withCredentials=e.withCredentials||!1;var s=new t(function(t,o){n.onload=function(e){for(var n={status:this.status,headers:{"Content-Type":this.getResponseHeader("Content-Type"),"Cache-Control":this.getResponseHeader("Cache-Control"),Expires:this.getResponseHeader("Expires")},type:this.responseType,body:this.responseText,xhr:this},s=0;s<r._responseInterceptors.length;s++)if(n=r._responseInterceptors[s].call(r,n),"object"!=typeof n)throw new Error("Response object is no longer an object after interception!");200===this.status?t(n):o(n)},n.onerror=function(){o({status:0,headers:{"Content-Type":"text/plain"},type:"error",body:"Connection Error",xhr:this});for(var t=0;t<r._catchInterceptors.length;t++)r._catchInterceptors[t](e),console.log(e)}});for(var i in e.headers)n.setRequestHeader(i,e.headers[i]);return e.body&&"string"!=typeof e.body&&(e.body=JSON.stringify(e.body)),n.send(e.body||null),s},u.prototype.get=function(e){return this.send({method:"GET",url:e})},u.prototype.post=function(e,t){return this.send({method:"POST",url:e,data:t})},u.prototype.put=function(e,t){return this.send({method:"PUT",url:e,data:t})},u.prototype.del=function(e){return this.send({method:"DELETE",url:e})},u.prototype.useDefaultInterceptors=function(){return this.onRequest(n).onRequest(s).onRequest(i).onResponse(p)},u.prototype.onRequest=function(e){if("function"!=typeof e)throw new Error("Interceptor must be a function!");return this._requestInterceptors.push(e),this},u.prototype.onResponse=function(e){if("function"!=typeof e)throw new Error("Interceptor must be a function!");return this._responseInterceptors.push(e),this},u.prototype.onCatch=function(e){if("function"!=typeof e)throw new Error("Interceptor must be a function!");return this._catchInterceptors.push(e),this};var a=function(){var e=new u;return e.useDefaultInterceptors(),e},c={create:a,Portal:u,interceptors:{validateRequest:r,mergeGlobalsRequest:n,buildUrlRequest:s,encodeJsonRequest:i,parseJsonResponse:p}};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=c),exports.portals=c):e.portals=c}).call(this);