"use strict";(function(){var e=this;if("undefined"==typeof t){if("function"!=typeof require)throw new Error('Portals requires "Promise" support');var t=require("promise/lib/es6-extensions")}var r=function(e){if("string"!=typeof e.method)throw new Error("Invalid method provided");if("string"!=typeof e.url)throw new Error("Invalid url provided");return e},o=function(e){return e.headers=this.globals.headers,e},n=function(e){return 0!==e.url.indexOf("http")&&(e.url=(e.hostname||"")+e.url),e},s=function(e){return e.data&&"string"==typeof e.headers["Content-Type"]&&-1!==e.headers["Content-Type"].indexOf("json")&&(e.body=JSON.stringify(e.data||e.body)),e},i=function(e){return e.headers["Content-Type"]&&-1!==e.headers["Content-Type"].indexOf("json")&&(e.body=JSON.parse(e.body)),e},p=function(){this.globals={hostname:"",method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}},this._requestInterceptors=[r],this._responseInterceptors=[]};p.prototype.send=function(e){if("object"!=typeof e)throw new Error("Options must be an object!");for(var r=0;r<this._requestInterceptors.length;r++)if(e=this._requestInterceptors[r].call(this,e),"object"!=typeof e)throw new Error("Options object is no longer an object after interception!");var o=this,n=new XMLHttpRequest;n.open(e.method.toUpperCase(),e.url,!0);var s=new t(function(e,t){n.onreadystatechange=function(){if(4===n.readyState){for(var r={status:this.status,headers:this.responseHeaders,body:this.responseText},s=0;s<o._responseInterceptors.length;s++)if(r=o._responseInterceptors[s].call(o,r),"object"!=typeof r)throw new Error("Response object is no longer an object after interception!");200===this.status?e(r):t(r)}}});for(var i in e.headers)n.setRequestHeader(i,e.headers[i]);return n.send(e.data||e.body||null),s},p.prototype.get=function(e){return this.send({method:"GET",url:e})},p.prototype.post=function(e,t){return this.send({method:"POST",url:e,data:t})},p.prototype.put=function(e,t){return this.send({method:"PUT",url:e,data:t})},p.prototype.del=function(e){return this.send({method:"DELETE",url:e})},p.prototype.useDefaultInterceptors=function(){return this.onRequest(o).onRequest(n).onRequest(s).onResponse(i)},p.prototype.onRequest=function(e){if("function"!=typeof e)throw new Error("Interceptor must be a function!");return this._requestInterceptors.push(e),this},p.prototype.onResponse=function(e){if("function"!=typeof e)throw new Error("Interceptor must be a function!");return this._responseInterceptors.push(e),this};var u=function(){var e=new p;return e.useDefaultInterceptors(),e},a={create:u,Portal:p,interceptors:{validateRequest:r,mergeGlobalsRequest:o,buildUrlRequest:n,encodeJsonRequest:s,parseJsonResponse:i}};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=a),exports.portals=a):e.portals=a}).call(this);